---
layout: default
title: Photoshop插件开发-菜单&面板
---
# {{ page.title }}  



###菜单
PS脚本文件可以通过 文件->脚本->浏览 来调用  
显然这样用起来很不爽，每次都需要点N次才能执行；我们可以通过配置把PS脚本通过一个“扳机”来触发，如把“扳机”放到菜单中，这样才像是插件。  
PS中有三个地方可以供放置：文件->自动、滤镜、帮助。我们开发的[PSD2HTML](https://github.com/wanxianjia/PSD2HTML)插件选择放在了帮助中。

菜单配置代码：

<pre>
/*
<javascriptresource> 
<name>PSD TO HTML</name> 
<about>v1.0--https://github.com/wanxianjia/PSD2HTML</about> 
<menu>help</menu> // automate，filter可供选择
<enableinfo>true</enableinfo> 
</javascriptresource>
*/
</pre>

_NO，这不是注释，他会生效的，PS脚本引擎添加了很多于浏览器端JS不一样的东西  
_例如引入另外一个JS文件：// @include "PSD2HTML/lib/i18n.jsx"，看上去也如注释一般。  



把上面代码保存为.jsx或.js文件，放到 PS安装目录\Presets\Scripts 目录下，重启PS，点开你的帮助菜单即可看到了PSD TO HTML这个菜单项了。

###面板

菜单弄好后，我们点击PSD TO HTML后我们肯定是需要做一些事情的，如弹出一个配置面板以便我们对PS插件的运行做一些配置。
在PSD2HTML插件中，我们需要弹出一个面板对生成的页面类型、图片格式、图片质量等做一些设置。

![Foo](img/panel.jpg)

<pre>
var ui = 'dialog{\
    text:"设置",\
    option: Group{\
        orientation:"column",\
        alignChildren: "left",\
        builder: Panel{\
            text: "请选择生成页面类型",\
            a: Group{\
                j: RadioButton{text:"静态页", helpTip:"Normal page", data:"normal",value:true}\
                e: RadioButton{text:"EDM", helpTip:"EDM", data:"EDM"},\
                l: RadioButton{text:"论坛贴", helpTip:"Editor code", data:"BBS"}\
            }\
        }
    },\
    buttons:Group{\
        ok: Button{text:"确定",  properties:{name:"ok"}},\
        cancel: Button{text:"取消",  properties:{name:"cancel"}}\
    }\
}';

var win = new Window(ui);
win.show();
</pre>
上面的代码片段创建了一个Window对象win，你可以通过win.option.builder这样来访问Window对象的child。
这种方法创建Window和浏览器端DOM使用innerHTML一样，同样PS端也可以采用类似createElement这样的方法来创建。  
如：
<pre>
// 参数一为window的类型:
//The window type. 
//One of: 
//•  window: Creates a simple window that can be used as a main window for an application. (Not supported by Photoshop CS3.) 
//•  palette: Creates a modeless dialog, also called a floating palette. (Not supported by Photoshop CS3.) 
//•  dialog: Creates a modal dialog. This argument can also be a ScriptUI resource specification; in that case, all other arguments are ignored. 
var win = new Window("dialog","Title"); 
var option = win.add("group", undefiend, "option",{orientation:"column",alignChildren:"left"});
 ...
</pre>

详细了解请查看文档：[InDesign JavaScript Reference Guide](http://www.jongware.com/idjshelp.html)

有了面板自然还需要添加一些事件，事件添加方式与基于浏览器的JS一样有两中方法：  
如上面的确定按钮事件添加：
<pre>
var OPTION = {
		image:{
			extension:'jpg',
			quality:60,
		},
		output:'/d/psd2html'
	};
win.buttons.ok.onClick = function(){
    
    var radios = win.option.builder.a.children;
    for(var i = 0, l = radios.length; i < l; i++){
        var radio = radios[i];
        if(radio.value === true){
            OPTION.builder = radio.data;
            break;
        }
    }
    if(OPTION.builder){
        alert("selectPageType");
    }else{
        OPTION.output = win.option.output.s.text;
        OPTION.image.quality = win.option.image.q.s.text;
        win.close();
        win = new Window('window{\
            g: Group{\
                tx: StaticText{text:"running"}\
            }\
        }');
        win.center();
        win.show();
        //$.evalFile(File($.fileName).parent+'/PSD2HTML/builder/toPage.jsx');       
        //APP.win.close();
    }
}
</pre>
或：
<pre>
win.buttons.ok.addEventListener('click', function(){});
</pre>
<p>{{ page.date | date_to_string }}</p>
